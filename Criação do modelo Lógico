-- Criando modelo l√≥gico de BD para sistema de E-commerce

CREATE DATABASE ECOMMERCE;

USE ECOMMERCE;

CREATE TABLE CLIENTE( 
  IDCLIENTE INT PRIMARY KEY AUTO_INCREMENT,
  FNOME VARCHAR(10),
  MINIT CHAR(3),
  LNOME VARCHAR(20),
  CPF CHAR(11) NOT NULL,
  ENDERECO VARCHAR(255),
  CONSTRAINT UNIQUE_CPF_CLIENTE UNIQUE(CPF)
);
ALTER TABLE CLIENTE AUTO_INCREMENT = 1;

CREATE TABLE PRODUTO( 
  IDPRODUTO INT PRIMARY KEY AUTO_INCREMENT,
  PNOME VARCHAR(10) NOT NULL,
  CLASSIFICACAO_KIDS BOOLEAN DEFAULT FALSE,
  CATEGORIA ENUM('ELETRONICO','VESTIMENTA','BRINQUEDOS','ALIMENTOS','MOVEIS') NOT NULL,
  AVALIACAO FLOAT(5,5) DEFAULT 0,
  DIMENSOES VARCHAR(10)
 );
 ALTER TABLE PRODUTO AUTO_INCREMENT = 1;

CREATE TABLE TipoPagamento (
	IDTIPOPAGAMENTO INT PRIMARY KEY AUTO_INCREMENT,
	Identificacao VARCHAR(50) NOT NULL,
	CONSTRAINT unique_TipoPagamento_Identificacao UNIQUE (Identificacao)	
);
ALTER TABLE TIPOPAGAMENTO AUTO_INCREMENT = 1;
CREATE TABLE TipoPagamentoPedido (
	IDTIPOPAGAMENTOPEDIDO INT PRIMARY KEY AUTO_INCREMENT,
	IDTPPedido INT NOT NULL,
	idTipoPagamento INT NOT NULL,
	Valor float(10,2),
	CONSTRAINT fk_TipoPagamentoPedido_idPedido FOREIGN KEY (IDTPPedido) REFERENCES PEDIDO(IDPEDIDO),
	CONSTRAINT fk_TipoPagamentoPedido_idTipoPagamento_TipoPagamento_id FOREIGN KEY (IDTIPOPAGAMENTOPEDIDO) REFERENCES TipoPagamento(IDTIPOPAGAMENTO) 
);


CREATE TABLE PEDIDO( 
  IDPEDIDO INT PRIMARY KEY AUTO_INCREMENT,
  ID_CLIENTE INT,
  STATUS ENUM('CANCELADO','CONFIRMADO','EM PROCESSAMENTO') NOT NULL,
  DESCRICAO VARCHAR(255),
  FRETE FLOAT(10,2) DEFAULT 10.00,
  CONSTRAINT FK_PEDIDO_CLIENTE FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (IDCLIENTE)
);
ALTER TABLE PEDIDO AUTO_INCREMENT = 1;

CREATE TABLE ESTOQUE( 
  IDESTOQUE INT PRIMARY KEY AUTO_INCREMENT,
  ENDE VARCHAR(55),
  QUANTIDADE INT NOT NULL DEFAULT 0
);
ALTER TABLE ESTOQUE AUTO_INCREMENT = 1;

CREATE TABLE FORNECEDOR( 
  IDFORNECEDOR INT PRIMARY KEY AUTO_INCREMENT,
  CNPJ VARCHAR(20) NOT NULL,
  RAZAOSOCIAL VARCHAR(60) NOT NULL,
  CONTATO VARCHAR(11) NOT NULL,
  CONSTRAINT UNIQUE_CNPJ_FORNECEDOR UNIQUE(CNPJ)
);
ALTER TABLE FORNECEDOR AUTO_INCREMENT = 1;

CREATE TABLE VENDEDOR(
 IDVENDEDOR INT PRIMARY KEY AUTO_INCREMENT,
 RAZAOSOCIAL VARCHAR(45),
 ENDE VARCHAR(45),
 NOMEFANTASIA VARCHAR(45),
 CNPJ VARCHAR(20),
 CPF VARCHAR(11),
 CONTATO VARCHAR(11) NOT NULL,
 CONSTRAINT UNIQUE_CNPJ_VENDEDOR UNIQUE(CNPJ),
 CONSTRAINT UNIQUE_CPF_VENDEDOR UNIQUE(CPF)
);
ALTER TABLE VENDEDOR AUTO_INCREMENT = 1;

CREATE TABLE PRODUTOVENDEDOR(
 IDPRODUTOVENDEDOR INT,
 IDP_PRODUTO INT,
 PRODQUANTIDADE INT NOT NULL,
 PRIMARY KEY (IDPRODUTOVENDEDOR,IDP_PRODUTO),
 CONSTRAINT FK_PRODUTOVENDEDOR_VENDEDOR FOREIGN KEY (IDPRODUTOVENDEDOR) REFERENCES VENDEDOR (IDVENDEDOR),
 CONSTRAINT FK_PRODUTOVENDEDOR_PRODUTO  FOREIGN KEY (IDP_PRODUTO) REFERENCES PRODUTO (IDPRODUTO)
);

CREATE TABLE PRODUTOPEDIDO(
 IDPRODUTOPEDIDO INT,
 IDP_P_PRODUTO INT,
 QUANTIDADE INT NOT NULL,
 PRIMARY KEY (IDPRODUTOPEDIDO,IDP_P_PRODUTO),
 CONSTRAINT FK_PRODUTOPEDIDO_PROD FOREIGN KEY (IDPRODUTOPEDIDO) REFERENCES PRODUTO (IDPRODUTO),
 CONSTRAINT FK_PRODUTOPEDIDO_PED  FOREIGN KEY (IDP_P_PRODUTO) REFERENCES PEDIDO (IDPEDIDO)
);

CREATE TABLE ESTOQUELOCAL(
 IDELPRODUTO INT,
 IDELESTOQUE INT,
 LOCALIDADE VARCHAR(100) NOT NULL,
 PRIMARY KEY (IDELPRODUTO,IDELESTOQUE),
 CONSTRAINT FK_ESTOQUELOCAL_PROD FOREIGN KEY (IDELPRODUTO) REFERENCES PRODUTO (IDPRODUTO),
 CONSTRAINT FK_ESTOQUELOCAL_ESTOQ  FOREIGN KEY (IDELESTOQUE) REFERENCES ESTOQUE (IDESTOQUE)
);

CREATE TABLE PRODUTOFORNECEDOR(
 IDPF_FORNECEDOR INT,
 IDPF_PRODUTO INT,
 QUANTIDADE INT NOT NULL,
 PRIMARY KEY (IDPF_FORNECEDOR,IDPF_PRODUTO),
 CONSTRAINT FK_PRODUTOFORNECEDOR_FORN FOREIGN KEY (IDPF_FORNECEDOR) REFERENCES FORNECEDOR (IDFORNECEDOR),
 CONSTRAINT FK_PRODUTOFORNECEDOR_PROD  FOREIGN KEY (IDPF_PRODUTO) REFERENCES PRODUTO (IDPRODUTO)
);
